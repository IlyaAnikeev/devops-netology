# Домашнее задание к занятию 17 «Инцидент-менеджмент»

## Задание

Составьте постмортем на основе реального сбоя системы GitHub в 2018 году.

Информацию о сбое можно изучить по ссылкам ниже:

* [краткое описание на русском языке](https://habr.com/ru/post/427301/);
* [развёрнутое описание на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

---

# Ответ

|------|-------------|
| Краткое описание инцидента | На нескольких сервисах GitHub.com пострадали несколько сетевых разделов и последующим сбоем базы данных, что привело к появлению непоследовательной информации на сайте GitHub.com |
| Предшествующие события | 21 октября 2018 года проводилось плановое техническое обслуживание по замене вышедшего из строя оптического оборудования 100G |
| Причина инцидента | 21 октября 2018 года произошла потеря соединения между сетевым хабом и основным ЦОД расположенных на восточном побережье США |
| Воздействие | Снижение качества обслуживания на 24 часа и 11 минут |
| Обнаружение | 21 октября 2018 года в 22:54 (UTC) системы внутреннего мониторинга начали генерировать предупреждения, указывающие на многочисленные сбои в работе систем. |
| Реакция | 21 октября 2018 года к 23:02 (UTC) инженеры из группы быстрого реагирования определили, что топологии для многочисленных кластеров баз данных находятся в неожиданном состоянии. Запрос к API Orchestrator показал топологию репликации базы данных, которая включала только серверы из центра обработки данных на западном побережье США. К этому моменту команда, отвечающая на запросы, решила вручную заблокировать внутренний инструментарий для развертывания, чтобы предотвратить внесение каких-либо дополнительных изменений. В 23:09 (UTC) команда, отвечающая на запросы, перевела сайт в желтый статус. Это действие автоматически привело к перерастанию ситуации в активный инцидент и отправке предупреждения координатору инцидента. В 23:11 (UTC) координатор инцидента подключился и через две минуты изменил статус решения на красный.|
| Восстановление | 22 октября 2018 года к 00:05 (UTC) инженерами был разработан план: восстановление из резервных копий, синхронизация реплик на обоих сайтах, возврат к стабильной топологии обслуживания, возобновление обработки заданий в очереди |
| Таймлайн | 21 октября 2018 года 22:52 (UTC) кратковременный обрыв (43 секуднды) соединения |
|          | 21 октября 2018 года 22:54 (UTC) генерация предупреждений внутренней системы мониторинга |
|          | 21 октября 2018 года 23:07 (UTC) ручная блокировка внутренних инструментов для развёртывания |
|          | 21 октября 2018 года 23:13 (UTC) проблема затронула несколько кластеров БД, были привлечены дополнительные инженеры из команды разработчиков |
|          | 21 октября 2018 года 23:19 (UTC) принята частичная остановка выполнения заданий, которые записывают метаданные |
|          | 22 октября 2018 года 00:05 (UTC) инженеры приступили к разработке плана устранения несоответствия данных (восстановление из резервных копий, синхронизация реплик на обоих сайтах) |
|          | 22 октября 2018 года 00:41 (UTC) к этому времени был запущен процесс резервного копирования |
|          | 22 октября 2018 года 06:51 (UTC) несколько кластеров завершили восстановление из резервных копий ЦОд на восточном побережье и начали реплицировать новые данные с заподного побережья США |
|          | 22 октября 2018 года 07:46 (UTC) команда GitHub опубликовала сообщение в блоге, чтобы предоставить больше информации об инциденте |
|          | 22 октября 2018 года 11:12 (UTC) все основные БД были снова установлены на восточном побережье США |
|          | 22 октября 2018 года 13:15 (UTC) были предоставлены дополнительные реплики для чтения MySQL в публичном облаке на восточном побережье США для уменьшения задержки репликации |
|          | 22 октября 2018 года 16:24 (UTC) после синхронизации реплик был выполнен переход на исходную топологию, чтобы устранить проблемы с задержкой и доступностью |
|          | 22 октября 2018 года 16:45 (UTC) обработка всего объёма накопившихся данных после инцидента |
|          | 22 октября 2018 года 23:03 (UTC) все ожидающие сборки веб-ссылок и страниц были обработаны, а целостность и правильная работа всех систем подтверждена. Статус сайта был обновлен до зеленого |
| Последующие действия | Во время восстановления были сохранены бинарные логи MySQL, которые были сделаны на основном сайте, но не были реплецированны на сайтна западном побережье США. Изменить конфигурацию оркестратора, чтобы предотвратить распространение основных ресурсов БД за пределы региональных границ. Был ускорен переход на новый механизм отчётности о статусе. За несколько недель до произошедшего инцидента была запущена общекорпоративныя инженерная инициатива по поддержке обслуживания трафика GitHub из нескольких ЦОД в режиме active/active/active design. Целью является поддержка резервирования N+1 на уровне предприятия. Внедрение систематической проверки сценариев сбоев до того, как они смогут повлиять на сервис. |


